#!/usr/bin/bash

# should be on the same CPU core as the attacking process, default cpu 0
key_adding_cpu=${1:-0}
# should be on a different CPU core than the key_adding process, default cpu 3
key_deleting_cpu=${2:-3}

echo -e "\nRunning victim process on cpu $key_adding_cpu...\n"

eval $(taskset -c $key_adding_cpu ssh-agent -s)

echo -e "\nRunning in an infinite loop:"
echo "taskset -c $key_deleting_cpu ssh-add -D &>/dev/null"
echo "taskset -c $key_adding_cpu ssh-add ./dummy_ecdsa &>/dev/null"

while true; do
  taskset -c $key_deleting_cpu ssh-add -D &>/dev/null
  taskset -c $key_adding_cpu ssh-add ./dummy_ecdsa &>/dev/null
done


